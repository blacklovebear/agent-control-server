- config:
    name: "smoketest for CRUD users."
    # variables:
    #     - device_sn: ${gen_random_string(15)}
    request:
        base_url: http://127.0.0.1:8080
        # headers:
        #     device_sn: $device_sn

- test:
    name: Canal server generate config file
    request:
        url: /config/canal/server
        method: POST
        json:
            zkServers: "172.18.84.224:2181"
            destinations: "citic"
    validate:
        - {"check": "body.action", "comparator": "eq", "expect": "POST"}
        - {"check": "body.message", "comparator": "eq", "expect": "success"}


- test:
    name: Canal instance generate config file
    request:
        url: /config/canal/instance
        method: POST
        json:
            instance: 'test'
            slaveId: 1234
            masterAddress: "127.0.0.1:3306"
            dbUsername: "root"
            dbPassword: "123456"
            filterRegex: ".*\\\\..*"
    validate:
        - {"check": "body.action", "comparator": "eq", "expect": "POST"}
        - {"check": "body.message", "comparator": "eq", "expect": "success"}


- test:
    name: TAgent generate config file
    request:
        url: /config/tagent
        method: POST
        json:
            sourceZkServers: 192.168.2.25:2181
            sourceDestination: citic
            sinkServers: 192.168.2.25:9092
            sinkTopicHeader: table

    validate:
        - {"check": "body.action", "comparator": "eq", "expect": "POST"}
        - {"check": "body.message", "comparator": "eq", "expect": "success"}


- test:
    name: start canal server
    request:
        url: /executor/start/canal
        method: GET
    validate:
        - {"check": "body.action", "comparator": "eq", "expect": "GET"}
        - {"check": "body.message", "comparator": "eq", "expect": "success"}

- test:
    name: stop canal server
    request:
        url: /executor/stop/canal
        method: GET
    validate:
        - {"check": "body.action", "comparator": "eq", "expect": "GET"}
        - {"check": "body.message", "comparator": "eq", "expect": "success"}


- test:
    name: start TAgent
    request:
        url: /executor/start/tagent
        method: GET
    validate:
        - {"check": "body.action", "comparator": "eq", "expect": "GET"}
        - {"check": "body.message", "comparator": "eq", "expect": "success"}

- test:
    name: stop TAgent
    request:
        url: /executor/stop/tagent
        method: GET
    validate:
        - {"check": "body.action", "comparator": "eq", "expect": "GET"}
        - {"check": "body.message", "comparator": "eq", "expect": "success"}